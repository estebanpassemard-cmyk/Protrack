<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProTrack V130</title>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; margin: 0; padding: 10px; }
        .menu { display: flex; background: #1e293b; padding: 5px; border-radius: 8px; margin-bottom: 20px; }
        .menu-btn { flex: 1; padding: 15px; border: none; background: none; color: #64748b; font-weight: bold; font-size: 14px; }
        .menu-btn.active { color: #3b82f6; background: #0f172a; border-radius: 5px; }
        
        .page { display: none; }
        .page-active { display: block; }

        .card { background: #1e293b; border-radius: 10px; padding: 15px; margin-bottom: 15px; border: 1px solid #334155; }
        .input { background: #0f172a; border: 1px solid #475569; color: white; border-radius: 8px; padding: 12px; width: 100%; font-size: 16px; margin-bottom: 10px; box-sizing: border-box; }
        .btn-main { background: #3b82f6; color: white; padding: 15px; border-radius: 10px; font-weight: bold; border: none; width: 100%; font-size: 16px; }
        
        .blue-text { color: #3b82f6; font-weight: bold; font-size: 11px; }
        .row { border-bottom: 1px solid #334155; padding: 10px 0; font-size: 12px; }
    </style>
</head>
<body>

    <div class="menu">
        <button class="menu-btn active" id="b0" onclick="window.go(0)">SAISIE</button>
        <button class="menu-btn" id="b1" onclick="window.go(1)">BILAN</button>
        <button class="menu-btn" id="b2" onclick="window.go(2)">ARCHIVES</button>
    </div>

    <div id="p0" class="page page-active">
        <div class="card">
            <input type="date" id="in-date" class="input">
            <input type="text" id="in-proj" placeholder="NOM DU PROJET" class="input">
            <select id="in-type" class="input">
                <option value="Production">Production</option>
                <option value="Trajet">Trajet</option>
                <option value="Pose Piges">Pose Piges</option>
                <option value="Pose Omnes">Pose Omnes</option>
                <option value="Jours OFF">Jours OFF</option>
            </select>
            <div style="display:flex; gap:5px;">
                <input type="time" id="s1" class="input">
                <input type="time" id="e1" class="input">
            </div>
            <div style="display:flex; gap:5px;">
                <input type="time" id="s2" class="input">
                <input type="time" id="e2" class="input">
            </div>
            <button class="btn-main" onclick="window.sauver()">ENREGISTRER</button>
        </div>
    </div>

    <div id="p1" class="page">
        <div id="bilan-content"></div>
    </div>

    <div id="p2" class="page">
        <div id="archive-content"></div>
    </div>

    <script>
        // Test immédiat au chargement
        alert("ProTrack V130 chargé !");

        var db = JSON.parse(localStorage.getItem('PT130_DB') || '[]');
        var billed = JSON.parse(localStorage.getItem('PT130_BI') || '[]');
        var arch = JSON.parse(localStorage.getItem('PT130_AR') || '[]');

        window.go = function(idx) {
            document.getElementById('p0').style.display = (idx === 0) ? 'block' : 'none';
            document.getElementById('p1').style.display = (idx === 1) ? 'block' : 'none';
            document.getElementById('p2').style.display = (idx === 2) ? 'block' : 'none';
            
            document.getElementById('b0').className = (idx === 0) ? 'menu-btn active' : 'menu-btn';
            document.getElementById('b1').className = (idx === 1) ? 'menu-btn active' : 'menu-btn';
            document.getElementById('b2').className = (idx === 2) ? 'menu-btn active' : 'menu-btn';
            
            if(idx > 0) window.dessiner();
        };

        window.sauver = function() {
            var dateV = document.getElementById('in-date').value;
            var projV = document.getElementById('in-proj').value.toUpperCase() || "DIVERS";
            var typeV = document.getElementById('in-type').value;

            if(!dateV) { alert("Mettre une date"); return; }

            // Calcul simplifié
            var s1 = document.getElementById('s1').value;
            var e1 = document.getElementById('e1').value;
            var s2 = document.getElementById('s2').value;
            var e2 = document.getElementById('e2').value;

            var entry = {
                id: new Date().getTime(),
                date: dateV,
                proj: projV,
                type: typeV,
                hStr: s1 + "-" + e1 + " / " + s2 + "-" + e2,
                val: 0 // Simplifié pour le test
            };

            db.unshift(entry);
            localStorage.setItem('PT130_DB', JSON.stringify(db));
            alert("Enregistré !");
            window.go(0);
        };

        window.dessiner = function() {
            var htmlB = "";
            for(var i=0; i<db.length; i++) {
                htmlB += '<div class="card">' + 
                            '<b>' + db[i].proj + '</b><br>' + 
                            db[i].date + ' | ' + db[i].hStr + 
                         '</div>';
            }
            document.getElementById('bilan-content').innerHTML = htmlB || "Aucune donnée";
        };

        document.getElementById('in-date').valueAsDate = new Date();
    </script>
</body>
</html>
