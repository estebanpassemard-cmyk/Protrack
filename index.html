<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProTrack V42</title>
    <style>
        /* CSS MINIMALISTE POUR ÉVITER LES CONFLITS */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: #0f172a; color: white; font-family: sans-serif; margin: 0; padding: 0; }
        
        .page { display: none; padding: 15px; padding-bottom: 90px; }
        .active { display: block !important; }

        .card { background: #1e293b; border-radius: 10px; padding: 15px; margin-bottom: 10px; border: 1px solid #334155; }
        .input { background: #0f172a; border: 1px solid #475569; color: white; border-radius: 5px; padding: 12px; width: 100%; font-size: 16px; margin-bottom: 10px; }
        
        .btn { background: #2563eb; color: white; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; text-transform: uppercase; cursor: pointer; }
        .btn-tab { flex: 1; padding: 20px 0; text-align: center; font-size: 12px; font-weight: bold; text-transform: uppercase; color: #64748b; }
        .tab-active { color: #3b82f6; border-top: 3px solid #3b82f6; background: #1e293b; }

        .nav { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; background: #0f172a; border-top: 1px solid #334155; z-index: 999; }
        .row { display: flex; justify-content: space-between; border-bottom: 1px solid #334155; padding: 10px 0; font-size: 11px; }
        .label { font-size: 10px; color: #94a3b8; margin-bottom: 4px; display: block; }
    </style>
</head>
<body>

    <div id="p0" class="page active">
        <div class="card">
            <input type="date" id="d" class="input">
            <input type="text" id="pr" placeholder="PROJET" class="input">
            <select id="ty" class="input">
                <option>Production</option><option>Trajet</option>
                <option>Pose Piges</option><option>Pose Omnes</option>
            </select>
            <div style="display:flex; gap:10px;">
                <div style="flex:1"><label class="label">MATIN</label><input type="time" id="s1" class="input"><input type="time" id="e1" class="input"></div>
                <div style="flex:1"><label class="label">APREM</label><input type="time" id="s2" class="input"><input type="time" id="e2" class="input"></div>
            </div>
            <div class="btn" onclick="save()">ENREGISTRER</div>
        </div>
        <div id="recents"></div>
    </div>

    <div id="p1" class="page">
        <div id="totals" style="display:flex; gap:10px; margin-bottom:10px;"></div>
        <div id="bilan"></div>
    </div>

    <div id="p2" class="page">
        <div id="archives"></div>
    </div>

    <div class="nav">
        <div id="n0" class="btn-tab tab-active" onclick="tab(0)">Saisie</div>
        <div id="n1" class="btn-tab" onclick="tab(1)">Bilan</div>
        <div id="n2" class="btn-tab" onclick="tab(2)">Archives</div>
    </div>

    <script>
        // LOGIQUE SIMPLIFIÉE À L'EXTRÊME
        var data = JSON.parse(localStorage.getItem('P42') || '[]');
        var bld = JSON.parse(localStorage.getItem('B42') || '[]');
        var arc = JSON.parse(localStorage.getItem('A42') || '[]');

        function tab(n) {
            // Masquer tout par force brute
            document.getElementById('p0').style.display = 'none';
            document.getElementById('p1').style.display = 'none';
            document.getElementById('p2').style.display = 'none';
            document.getElementById('n0').className = 'btn-tab';
            document.getElementById('n1').className = 'btn-tab';
            document.getElementById('n2').className = 'btn-tab';

            // Afficher
            document.getElementById('p' + n).style.display = 'block';
            document.getElementById('n' + n).className = 'btn-tab tab-active';
            render();
        }

        function save() {
            var date = document.getElementById('d').value;
            var proj = document.getElementById('pr').value || 'DIVERS';
            if(!date) return alert('Date ?');

            var val = 100; // Test valeur fixe pour vérifier si ça enregistre
            var h = document.getElementById('s1').value + "-" + document.getElementById('e2').value;

            data.unshift({id: Date.now(), d: date, p: proj, v: val, h: h});
            localStorage.setItem('P42', JSON.stringify(data));
            alert('Enregistré !');
            render();
        }

        function render() {
            var html = "";
            data.slice(0,3).forEach(function(o) {
                html += '<div class="card">'+o.p+' - '+o.h+'</div>';
            });
            document.getElementById('recents').innerHTML = html;

            if(document.getElementById('p1').style.display == 'block') {
                var bHtml = "";
                data.forEach(function(o) {
                    bHtml += '<div class="row"><span>'+o.d+'</span><b>'+o.p+'</b><span>'+o.h+'</span></div>';
                });
                document.getElementById('bilan').innerHTML = bHtml;
            }
        }

        document.getElementById('d').valueAsDate = new Date();
        render();
    </script>
</body>
</html>
